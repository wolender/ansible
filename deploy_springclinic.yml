---
- hosts: all
  become: true
  tasks:
  - name: update system
    yum:
      name: '*'
      state: latest
    when: ansible_distribution == "Amazon"
  - name: install java 17
    yum:
      name: java-17-amazon-corretto-devel.x86_64
      state: present
  - name: install maven package
    yum:
      name: maven
    when: ansible_distribution == "Amazon"
  - name: install docker
    yum: 
      name: docker
      state: present
  - name: adding trusted docker repo
    shell: echo '{ "insecure-registries" : ["http://ec2-3-120-208-86.eu-central-1.compute.amazonaws.com:1111"] }' >> /etc/docker/daemon.json

  - name: get docker image
    shell: "docker login -u admin -p iG57vVuKjpHCgPa http://{{ lookup('env', 'SERVER') }}:1111"
      
  - name: run the app
    shell: docker run petclinic -p 8080:8080